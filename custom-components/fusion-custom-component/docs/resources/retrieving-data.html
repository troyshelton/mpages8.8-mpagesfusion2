<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>MPages</title>
        <style>
            .hljs {
                display: block;
                overflow-x: auto;
                padding: 0.5em;
                color: #000;
                background: #fff;
            }
            .hljs-subst,
            .hljs-title {
                font-weight: 400;
                color: #000;
            }
            .hljs-comment,
            .hljs-quote {
                color: grey;
                font-style: italic;
            }
            .hljs-meta {
                color: olive;
            }
            .hljs-tag {
                background: #efefef;
            }
            .hljs-keyword,
            .hljs-literal,
            .hljs-name,
            .hljs-section,
            .hljs-selector-class,
            .hljs-selector-id,
            .hljs-selector-tag,
            .hljs-type {
                font-weight: 700;
                color: navy;
            }
            .hljs-attribute,
            .hljs-link,
            .hljs-number,
            .hljs-regexp {
                font-weight: 700;
                color: #00f;
            }
            .hljs-link,
            .hljs-number,
            .hljs-regexp {
                font-weight: 400;
            }
            .hljs-string {
                color: green;
                font-weight: 700;
            }
            .hljs-bullet,
            .hljs-formula,
            .hljs-symbol {
                color: #000;
                background: #d0eded;
                font-style: italic;
            }
            .hljs-doctag {
                text-decoration: underline;
            }
            .hljs-template-variable,
            .hljs-variable {
                color: #660e7a;
            }
            .hljs-addition {
                background: #baeeba;
            }
            .hljs-deletion {
                background: #ffc8bd;
            }
            .hljs-emphasis {
                font-style: italic;
            }
            .hljs-strong {
                font-weight: 700;
            }
            .setup-markdown {
                padding: 1rem;
                -ms-text-size-adjust: 100%;
                -webkit-text-size-adjust: 100%;
                line-height: 1.5;
                color: #24292e;
                font-family: -apple-system, system-ui, BlinkMacSystemFont,
                    "Segoe UI", Helvetica, Arial, sans-serif,
                    "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
                font-size: 16px;
                word-wrap: break-word;
            }
            .setup-markdown .pl-c {
                color: #969896;
            }
            .setup-markdown .pl-c1,
            .setup-markdown .pl-s .pl-v {
                color: #0086b3;
            }
            .setup-markdown .pl-e,
            .setup-markdown .pl-en {
                color: #795da3;
            }
            .setup-markdown .pl-s .pl-s1,
            .setup-markdown .pl-smi {
                color: #333;
            }
            .setup-markdown .pl-ent {
                color: #63a35c;
            }
            .setup-markdown .pl-k {
                color: #a71d5d;
            }
            .setup-markdown .pl-pds,
            .setup-markdown .pl-s,
            .setup-markdown .pl-s .pl-pse .pl-s1,
            .setup-markdown .pl-sr,
            .setup-markdown .pl-sr .pl-cce,
            .setup-markdown .pl-sr .pl-sra,
            .setup-markdown .pl-sr .pl-sre {
                color: #183691;
            }
            .setup-markdown .pl-smw,
            .setup-markdown .pl-v {
                color: #ed6a43;
            }
            .setup-markdown .pl-bu {
                color: #b52a1d;
            }
            .setup-markdown .pl-ii {
                color: #f8f8f8;
                background-color: #b52a1d;
            }
            .setup-markdown .pl-c2 {
                color: #f8f8f8;
                background-color: #b52a1d;
            }
            .setup-markdown .pl-c2::before {
                content: "^M";
            }
            .setup-markdown .pl-sr .pl-cce {
                font-weight: 700;
                color: #63a35c;
            }
            .setup-markdown .pl-ml {
                color: #693a17;
            }
            .setup-markdown .pl-mh,
            .setup-markdown .pl-mh .pl-en,
            .setup-markdown .pl-ms {
                font-weight: 700;
                color: #1d3e81;
            }
            .setup-markdown .pl-mq {
                color: teal;
            }
            .setup-markdown .pl-mi {
                font-style: italic;
                color: #333;
            }
            .setup-markdown .pl-mb {
                font-weight: 700;
                color: #333;
            }
            .setup-markdown .pl-md {
                color: #bd2c00;
                background-color: #ffecec;
            }
            .setup-markdown .pl-mi1 {
                color: #55a532;
                background-color: #eaffea;
            }
            .setup-markdown .pl-mc {
                color: #ef9700;
                background-color: #ffe3b4;
            }
            .setup-markdown .pl-mi2 {
                color: #d8d8d8;
                background-color: grey;
            }
            .setup-markdown .pl-mdr {
                font-weight: 700;
                color: #795da3;
            }
            .setup-markdown .pl-mo {
                color: #1d3e81;
            }
            .setup-markdown .pl-ba {
                color: #595e62;
            }
            .setup-markdown .pl-sg {
                color: silver;
            }
            .setup-markdown .pl-corl {
                text-decoration: underline;
                color: #183691;
            }
            .setup-markdown .octicon {
                display: inline-block;
                vertical-align: text-top;
                fill: currentColor;
            }
            .setup-markdown a {
                background-color: transparent;
                -webkit-text-decoration-skip: objects;
            }
            .setup-markdown a:active,
            .setup-markdown a:hover {
                outline-width: 0;
            }
            .setup-markdown strong {
                font-weight: inherit;
            }
            .setup-markdown strong {
                font-weight: bolder;
            }
            .setup-markdown h1 {
                font-size: 2em;
                margin: 0.67em 0;
            }
            .setup-markdown img {
                border-style: none;
            }
            .setup-markdown svg:not(:root) {
                overflow: hidden;
            }
            .setup-markdown code,
            .setup-markdown kbd,
            .setup-markdown pre {
                font-family: monospace, monospace;
                font-size: 1em;
            }
            .setup-markdown hr {
                box-sizing: content-box;
                height: 0;
                overflow: visible;
            }
            .setup-markdown input {
                font: inherit;
                margin: 0;
            }
            .setup-markdown input {
                overflow: visible;
            }
            .setup-markdown [type="checkbox"] {
                box-sizing: border-box;
                padding: 0;
            }
            .setup-markdown * {
                box-sizing: border-box;
            }
            .setup-markdown input {
                font-family: inherit;
                font-size: inherit;
                line-height: inherit;
            }
            .setup-markdown a {
                color: #0366d6;
                text-decoration: none;
            }
            .setup-markdown a:hover {
                text-decoration: underline;
            }
            .setup-markdown strong {
                font-weight: 600;
            }
            .setup-markdown hr {
                height: 0;
                margin: 15px 0;
                overflow: hidden;
                background: 0 0;
                border: 0;
                border-bottom: 1px solid #dfe2e5;
            }
            .setup-markdown hr::before {
                display: table;
                content: "";
            }
            .setup-markdown hr::after {
                display: table;
                clear: both;
                content: "";
            }
            .setup-markdown table {
                border-spacing: 0;
                border-collapse: collapse;
            }
            .setup-markdown td,
            .setup-markdown th {
                padding: 0;
            }
            .setup-markdown h1,
            .setup-markdown h2,
            .setup-markdown h3,
            .setup-markdown h4,
            .setup-markdown h5,
            .setup-markdown h6 {
                margin-top: 0;
                margin-bottom: 0;
            }
            .setup-markdown h1 {
                font-size: 32px;
                font-weight: 600;
            }
            .setup-markdown h2 {
                font-size: 24px;
                font-weight: 600;
            }
            .setup-markdown h3 {
                font-size: 20px;
                font-weight: 600;
            }
            .setup-markdown h4 {
                font-size: 16px;
                font-weight: 600;
            }
            .setup-markdown h5 {
                font-size: 14px;
                font-weight: 600;
            }
            .setup-markdown h6 {
                font-size: 12px;
                font-weight: 600;
            }
            .setup-markdown p {
                margin-top: 0;
                margin-bottom: 10px;
            }
            .setup-markdown blockquote {
                margin: 0;
            }
            .setup-markdown ol,
            .setup-markdown ul {
                padding-left: 0;
                margin-top: 0;
                margin-bottom: 0;
            }
            .setup-markdown ol ol,
            .setup-markdown ul ol {
                list-style-type: lower-roman;
            }
            .setup-markdown ol ol ol,
            .setup-markdown ol ul ol,
            .setup-markdown ul ol ol,
            .setup-markdown ul ul ol {
                list-style-type: lower-alpha;
            }
            .setup-markdown dd {
                margin-left: 0;
            }
            .setup-markdown code {
                font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo,
                    Courier, monospace;
                font-size: 12px;
            }
            .setup-markdown pre {
                margin-top: 0;
                margin-bottom: 0;
                font: 12px SFMono-Regular, Consolas, "Liberation Mono", Menlo,
                    Courier, monospace;
            }
            .setup-markdown .octicon {
                vertical-align: text-bottom;
            }
            .setup-markdown .pl-0 {
                padding-left: 0 !important;
            }
            .setup-markdown .pl-1 {
                padding-left: 4px !important;
            }
            .setup-markdown .pl-2 {
                padding-left: 8px !important;
            }
            .setup-markdown .pl-3 {
                padding-left: 16px !important;
            }
            .setup-markdown .pl-4 {
                padding-left: 24px !important;
            }
            .setup-markdown .pl-5 {
                padding-left: 32px !important;
            }
            .setup-markdown .pl-6 {
                padding-left: 40px !important;
            }
            .setup-markdown::before {
                display: table;
                content: "";
            }
            .setup-markdown::after {
                display: table;
                clear: both;
                content: "";
            }
            .setup-markdown > :first-child {
                margin-top: 0 !important;
            }
            .setup-markdown > :last-child {
                margin-bottom: 0 !important;
            }
            .setup-markdown a:not([href]) {
                color: inherit;
                text-decoration: none;
            }
            .setup-markdown .anchor {
                float: left;
                padding-right: 4px;
                margin-left: -20px;
                line-height: 1;
            }
            .setup-markdown .anchor:focus {
                outline: 0;
            }
            .setup-markdown blockquote,
            .setup-markdown dl,
            .setup-markdown ol,
            .setup-markdown p,
            .setup-markdown pre,
            .setup-markdown table,
            .setup-markdown ul {
                margin-top: 0;
                margin-bottom: 16px;
            }
            .setup-markdown hr {
                height: 0.25em;
                padding: 0;
                margin: 24px 0;
                background-color: #e1e4e8;
                border: 0;
            }
            .setup-markdown blockquote {
                padding: 0 1em;
                color: #6a737d;
                border-left: 0.25em solid #dfe2e5;
            }
            .setup-markdown blockquote > :first-child {
                margin-top: 0;
            }
            .setup-markdown blockquote > :last-child {
                margin-bottom: 0;
            }
            .setup-markdown kbd {
                display: inline-block;
                padding: 3px 5px;
                font-size: 11px;
                line-height: 10px;
                color: #444d56;
                vertical-align: middle;
                background-color: #fafbfc;
                border: solid 1px #c6cbd1;
                border-bottom-color: #959da5;
                border-radius: 3px;
                box-shadow: inset 0 -1px 0 #959da5;
            }
            .setup-markdown h1,
            .setup-markdown h2,
            .setup-markdown h3,
            .setup-markdown h4,
            .setup-markdown h5,
            .setup-markdown h6 {
                margin-top: 24px;
                margin-bottom: 16px;
                font-weight: 600;
                line-height: 1.25;
            }
            .setup-markdown h1 .octicon-link,
            .setup-markdown h2 .octicon-link,
            .setup-markdown h3 .octicon-link,
            .setup-markdown h4 .octicon-link,
            .setup-markdown h5 .octicon-link,
            .setup-markdown h6 .octicon-link {
                color: #1b1f23;
                vertical-align: middle;
                visibility: hidden;
            }
            .setup-markdown h1:hover .anchor,
            .setup-markdown h2:hover .anchor,
            .setup-markdown h3:hover .anchor,
            .setup-markdown h4:hover .anchor,
            .setup-markdown h5:hover .anchor,
            .setup-markdown h6:hover .anchor {
                text-decoration: none;
            }
            .setup-markdown h1:hover .anchor .octicon-link,
            .setup-markdown h2:hover .anchor .octicon-link,
            .setup-markdown h3:hover .anchor .octicon-link,
            .setup-markdown h4:hover .anchor .octicon-link,
            .setup-markdown h5:hover .anchor .octicon-link,
            .setup-markdown h6:hover .anchor .octicon-link {
                visibility: visible;
            }
            .setup-markdown h1 {
                padding-bottom: 0.3em;
                font-size: 2em;
                border-bottom: 1px solid #eaecef;
            }
            .setup-markdown h2 {
                padding-bottom: 0.3em;
                font-size: 1.5em;
                border-bottom: 1px solid #eaecef;
            }
            .setup-markdown h3 {
                font-size: 1.25em;
            }
            .setup-markdown h4 {
                font-size: 1em;
            }
            .setup-markdown h5 {
                font-size: 0.875em;
            }
            .setup-markdown h6 {
                font-size: 0.85em;
                color: #6a737d;
            }
            .setup-markdown ol,
            .setup-markdown ul {
                padding-left: 2em;
            }
            .setup-markdown ol ol,
            .setup-markdown ol ul,
            .setup-markdown ul ol,
            .setup-markdown ul ul {
                margin-top: 0;
                margin-bottom: 0;
            }
            .setup-markdown li > p {
                margin-top: 16px;
            }
            .setup-markdown li + li {
                margin-top: 0.25em;
            }
            .setup-markdown dl {
                padding: 0;
            }
            .setup-markdown dl dt {
                padding: 0;
                margin-top: 16px;
                font-size: 1em;
                font-style: italic;
                font-weight: 600;
            }
            .setup-markdown dl dd {
                padding: 0 16px;
                margin-bottom: 16px;
            }
            .setup-markdown table {
                display: block;
                width: 100%;
                overflow: auto;
            }
            .setup-markdown table th {
                font-weight: 600;
            }
            .setup-markdown table td,
            .setup-markdown table th {
                padding: 6px 13px;
                border: 1px solid #dfe2e5;
            }
            .setup-markdown table tr {
                background-color: #fff;
                border-top: 1px solid #c6cbd1;
            }
            .setup-markdown table tr:nth-child(2n) {
                background-color: #f6f8fa;
            }
            .setup-markdown img {
                max-width: 100%;
                box-sizing: content-box;
                background-color: #fff;
            }
            .setup-markdown code {
                padding: 0;
                padding-top: 0.2em;
                padding-bottom: 0.2em;
                margin: 0;
                font-size: 85%;
                background-color: rgba(27, 31, 35, 0.05);
                border-radius: 3px;
            }
            .setup-markdown code::after,
            .setup-markdown code::before {
                letter-spacing: -0.2em;
                content: "\00a0";
            }
            .setup-markdown pre {
                word-wrap: normal;
            }
            .setup-markdown pre > code {
                padding: 0;
                margin: 0;
                font-size: 100%;
                word-break: normal;
                white-space: pre;
                background: 0 0;
                border: 0;
            }
            .setup-markdown .highlight {
                margin-bottom: 16px;
            }
            .setup-markdown .highlight pre {
                margin-bottom: 0;
                word-break: normal;
            }
            .setup-markdown .highlight pre,
            .setup-markdown pre {
                padding: 16px;
                overflow: auto;
                font-size: 85%;
                line-height: 1.45;
                background-color: #f6f8fa;
                border-radius: 3px;
            }
            .setup-markdown pre code {
                display: inline;
                max-width: auto;
                padding: 0;
                margin: 0;
                overflow: visible;
                line-height: inherit;
                word-wrap: normal;
                background-color: transparent;
                border: 0;
            }
            .setup-markdown pre code::after,
            .setup-markdown pre code::before {
                content: normal;
            }
            .setup-markdown .full-commit .btn-outline:not(:disabled):hover {
                color: #005cc5;
                border-color: #005cc5;
            }
            .setup-markdown kbd {
                display: inline-block;
                padding: 3px 5px;
                font: 11px SFMono-Regular, Consolas, "Liberation Mono", Menlo,
                    Courier, monospace;
                line-height: 10px;
                color: #444d56;
                vertical-align: middle;
                background-color: #fcfcfc;
                border: solid 1px #c6cbd1;
                border-bottom-color: #959da5;
                border-radius: 3px;
                box-shadow: inset 0 -1px 0 #959da5;
            }
            .setup-markdown :checked + .radio-label {
                position: relative;
                z-index: 1;
                border-color: #0366d6;
            }
            .setup-markdown .task-list-item {
                list-style-type: none;
            }
            .setup-markdown .task-list-item + .task-list-item {
                margin-top: 3px;
            }
            .setup-markdown .task-list-item input {
                margin: 0 0.2em 0.25em -1.6em;
                vertical-align: middle;
            }
            .setup-markdown hr {
                border-bottom-color: #eee;
            }
        </style>
    </head>
    <body>
        <div id="root" class="setup-markdown">
            <h1 id="retrieving-data">Retrieving Data</h1>
            <p>
                The provided template contains an <code>index.js</code> file.
                This allows you to control how things are imported from the
                <code>data-retrieval</code> folder.
            </p>
            <h2 id="usage">Usage</h2>
            <pre><code class="hljs "><span class="hljs-keyword">data</span>-retrieval/
    getData.js
    <span class="hljs-built_in">index</span>.js</code></pre>
            <p>
                Ensure that you update <code>index.js</code> to export the
                module according to the following example:
            </p>
            <pre><code class="hljs javascript"><span class="hljs-comment">// In index.js</span>
<span class="hljs-keyword">import</span> getData <span class="hljs-keyword">from</span> <span class="hljs-string">"./getData"</span>;
<span class="hljs-keyword">export</span> { getData };</code></pre>
            <p>
                Implement the actual <code>getData</code> module using the
                following example:
            </p>
            <pre><code class="hljs javascript">// In getData.js
import ScriptRequest from <span class="hljs-string">"ScriptRequest"</span><span class="hljs-comment">;</span>

const getData = ({
<span class="hljs-built_in">    personId,</span>
<span class="hljs-built_in">    encounter,</span>
<span class="hljs-built_in">    providerId,</span>
<span class="hljs-built_in">    lookbackUnits,</span>
<span class="hljs-built_in">    lookbackTypeFlag,</span>
<span class="hljs-built_in">    events,</span>
    pprCode
}) =&gt;
    <span class="hljs-keyword">new</span> Promise((resolve, reject) =&gt; {
        <span class="hljs-keyword">new</span> ScriptRequest()
            .setProgramName(<span class="hljs-string">"MP_RETRIEVE_DATA"</span>)
            .setParameterArray([
                <span class="hljs-string">"^MINE^"</span>,
<span class="hljs-built_in">                personId,</span>
<span class="hljs-built_in">                encounter,</span>
<span class="hljs-built_in">                providerId,</span>
<span class="hljs-built_in">                lookbackUnits,</span>
                events <span class="hljs-comment">/* ... */</span>,
                ,
<span class="hljs-built_in">                0,</span>
<span class="hljs-built_in">                0,</span>
                <span class="hljs-number">1</span>
            ])
            .setResponseHandler((reply) =&gt; {
                if (!isError(reply)) {
                    resolve(reply.getResponse().DOCS)<span class="hljs-comment">;</span>
                } else {
                    reject(reply.getError())<span class="hljs-comment">;</span>
                }
            })
            .performRequest()<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span></code></pre>
            <p>
                This implementation uses the <code>ScriptRequest</code> API and
                wraps it in a
                <a
                    href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise"
                    >Promise</a
                >. Use discretion when deciding whether to use
                <code>FusionComponentScriptRequest</code>.
            </p>
            <h2 id="chaining-additional-calls">Chaining Additional Calls</h2>
            <p>
                After writing the first retrieval module, you can make
                additional script calls to retrieve other data. The following
                example uses <code>getOutsideRecords</code> and is created under
                <code>data-retrieval</code>:
            </p>
            <pre><code class="hljs ">data-retrieval/
    getOutsideRecords<span class="hljs-selector-class">.js</span>
    getData<span class="hljs-selector-class">.js</span>
    index.js</code></pre>
            <p>Ensure that you add this to <code>index.js</code>:</p>
            <pre><code class="hljs javascript"><span class="hljs-comment">// In index.js</span>
<span class="hljs-keyword">import</span> getOutsideRecords <span class="hljs-keyword">from</span> <span class="hljs-string">"./getOutsideRecords"</span>;
<span class="hljs-keyword">import</span> getData <span class="hljs-keyword">from</span> <span class="hljs-string">"./getData"</span>;
<span class="hljs-keyword">export</span> { getOutsideRecords, getData };</code></pre>
            <p>
                An advantage of <code>index.js</code> is that you can
                restructure the internal folder structure of
                <code>data-retrieval</code> as long as the API exposed by
                <code>index.js</code> remains intact. The following example
                skips implementation of <code>getOutsideRecords</code> and
                component data retrieval has been configured to wait for both
                <code>getData</code> and <code>getOutsideRecords</code> to
                finish. This configuration can be complicated using the legacy
                <em>MPages</em> framework but has been simplified with
                <code>Promises</code> in <em>MPages</em> Fusion:
            </p>
            <pre><code class="hljs javascript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExampleFusionComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">FusionComponent</span> </span>{
    retrieveComponentData() {
        <span class="hljs-type">Promise</span>.all([
            getOutsideRecords(<span class="hljs-comment">/* ... */</span>)
            getData(<span class="hljs-comment">/* ... */</span>)
        ]).then((values) =&gt; {
            console.log(values); <span class="hljs-comment">// [ Outside records, Render Data ]</span>
        });
    }
}</code></pre>
        </div>
    </body>
</html>
